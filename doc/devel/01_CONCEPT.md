# VTuneHub - VTuber統合管理システム コンセプトドキュメント

## 1. プロジェクト概要

### 1.1 サービス名
**VTuneHub** (ブイチューンハブ)
- VTuber活動のハブとして、配信に伴う作業を効率化するシステム

### 1.2 ビジョン
VTuber活動における煩雑な管理業務を一元化し、配信者が本来のクリエイティブ活動に集中できる環境を提供する。技術的知識がなくても直感的に操作でき、完全無料で運用可能な統合管理プラットフォーム。

### 1.3 提供価値

#### VTuber（配信者）への価値
- **業務効率化**: 配信準備から振り返りまでの作業を軽減
- **ミス防止**: チェックリストによる配信事故の予防
- **視聴者満足度向上**: 楽曲リクエスト対応の効率化
- **成長支援**: アナリティクスによる客観的な活動分析

#### リスナー（視聴者）への価値
- **利便性向上**: 配信スケジュール・楽曲リストの簡単確認
- **参加感向上**: リクエスト可能楽曲の透明性
- **アクセス性**: スマートフォンからの快適な閲覧

## 2. システム構成

### 2.1 アーキテクチャ

```
┌─────────────────────────────────────────────────┐
│                   ユーザー層                      │
├──────────────────┬──────────────────────────────┤
│   管理画面(SPA)   │    公開ページ(Static)         │
│  - 認証付き       │    - 認証なし                │
│  - React         │    - 静的HTML/CSS/JS         │
└──────────────────┴──────────────────────────────┘
                    ▼
┌─────────────────────────────────────────────────┐
│            Cloudflare Workers                    │
│  - API エンドポイント                             │
│  - 認証処理 (Magic Link)                         │
│  - データ検証・変換                               │
└──────────────────────────────────────────────────┘
                    ▼
┌─────────────────────────────────────────────────┐
│              データ層                             │
├──────────────────┬──────────────────────────────┤
│  Cloudflare D1    │    Cloudflare KV             │
│  - 永続データ      │    - セッション               │
│  - SQLite         │    - キャッシュ               │
└──────────────────┴──────────────────────────────┘
```

### 2.2 技術スタック

| レイヤー | 技術 | 選定理由 |
|---------|------|----------|
| フロントエンド | React + TypeScript | 型安全性とエコシステムの充実 |
| スタイリング | Tailwind CSS | 開発速度とカスタマイズ性 |
| バックエンド | Cloudflare Workers | サーバーレス・低コスト運用 |
| データベース | Cloudflare D1 | SQLiteベース・Workers統合 |
| Key-Valueストレージ | Cloudflare KV | 高速読み取り・セッション管理 |
| 認証 | Magic Link (自前実装) | UX向上・パスワード管理不要 |
| ホスティング | Cloudflare Pages | Workers統合・グローバルCDN |

### 2.3 料金体系

**完全無料** - Cloudflareの無料枠内で全機能を提供

| サービス | 無料枠 | 想定使用量 |
|---------|--------|-----------|
| Workers | 10万リクエスト/日 | 1,000リクエスト/日 |
| D1 | 10GB | 100MB |
| KV | 10万読み取り/日 | 5,000読み取り/日 |
| Pages | 無制限 | - |

## 3. 機能仕様

### 3.1 コア機能マップ

```
VTuneHub
├── 認証・ユーザー管理
│   ├── Magic Link認証
│   ├── セッション管理
│   ├── プロフィール設定
│   ├── インポート・エクスポート
│   └── アカウント削除
│
├── 配信管理
│   ├── スケジュール管理
│   │   ├── カレンダービュー(月・週)
│   │   ├── 定期配信設定
│   │   ├── SNS告知文生成
│   │   └── SNS告知文テンプレート管理
│   ├── 配信準備チェックリスト
│   │   ├── チェックリストテンプレート管理
│   │   └── チェック履歴
│   └── 配信メタデータ管理
│
├── コンテンツ管理
│   ├── 楽曲データベース
│   │   ├── 楽曲登録・編集
│   │   ├── ジャンル分類
│   │   └── 歌唱履歴記録
│   ├── リクエスト・質問管理
│   │   ├── カテゴリ分類
│   │   └── 回答履歴
│   └── セットリスト作成
│
├── 公開ページ機能
│   ├── 配信予定
│   ├── 楽曲検索
│   │   └── リクエスト投稿
│   ├── 質問投稿
│   └── リンク集
│
└── アナリティクス
    ├── 配信統計
    ├── 楽曲パフォーマンス
    └── 成長トレンド
```

### 3.2 機能詳細

#### 3.2.1 認証・ユーザー管理機能

**Magic Link認証フロー**
1. メールアドレス入力
2. 認証メール送信（有効期限15分）
3. リンククリックで認証完了
4. 30日間有効なセッション発行


**機能仕様**
- emailベースのmagic linkによる認証
- cookieを用いたセッション管理
- プロフィール作成・編集。項目は未定。下記は含める
  - VTuberとしての名前
  - ユーザーアイコン画像
  - YouTubeチャンネルへのリンク
  - その他リンクとリンク先名とリンク先アイコン（fontawesome）
- 全データのエクスポート・インポート
  - CSV, JSON形式での全データエクスポート機能
    - CSVはexcelなどへのimport目的、JSONは個人バックアップorアカウント復活後リストア目的
    - JSONは1ファイル、CSVはカテゴリ（楽曲リスト、スケジュール、プロファイル、質問、リクエスト）ごとに独立ファイル
      - JSONはデフォルトで全カテゴリエクスポート
        - チェックボックスに個別複数カテゴリ対応
  - CSV/JSONのワンクリックインポート（merge）
    - 上書きマージ、上書き警告は出さない、インポート前に初期化はしない（初期化しないことを伝える）
    - JSONの場合は上書きカテゴリを選択可能(デフォルトはJSONに存在するカテゴリ全て)
  - 選択カテゴリの全データ削除機能（インポートに備える）
- アカウント削除による、DBを即削除
  - たぶんバッチ処理にしなくても最初はパフォーマンスボトルネックにはならないと思う

**実装詳細**
- セッションIDはKV Storeに格納
- セッションはhttpOnly Cookieで管理
- CSRF対策としてSameSite=Lax設定
- 認証レート制限: 1IPあたり10回/時

#### 3.2.2 配信管理機能

**配信スケジュールデータモデル(例)**
```typescript
interface Stream {
  id: string;
  title: string;
  scheduledAt: Date;
  platform: 'youtube' | 'twitch' | 'niconico';
  streamType: 'chat' | 'game' | 'singing' | 'collab';
  description?: string;
  thumbnailUrl?: string;
  tags: string[];
  isPublic: boolean;
  createdAt: Date;
  updatedAt: Date;
}
```

**配信スケジュール機能仕様**
- ドラッグ&ドロップでの予定変更
- 一日の開始時間と終了時間を変更可能(生活スタイルがVごとに違うため)
- 配信状態の管理
  - 配信すると決めたら未公開かつ確定状態に遷移
  - 公開すると決めたら公開かつ確定状態に遷移
  - 配信を終えたら終了状態に遷移
  - 配信をせず延期を決めたら、スケジュールを削除するか、別の日程に未公開かつ確定状態に遷移
- 繰り返し配信の自動生成(未公開かつ未確定状態)
- テンプレートを用いたSNS告知文作成
  - 告知文に常に登場するタグなどをテンプレートとして指定可能
  - 複数テンプレート対応、枠種別に結びつけ可能
- iCal形式でのエクスポート
- 配信15分前のリマインダー（ブラウザ通知）

**配信準備チェックリスト機能仕様**
- テンプレートを用いたチェックリストの再利用
- 個別配信ごと、枠種別ごとに追加のチェックリストを指定可能

**配信メタデータ管理機能仕様**
- 枠種別(歌枠・雑談枠・ゲーム枠など)
- その他、未検討

#### 3.2.3 コンテンツ管理機能

**楽曲データモデル(例)**
```typescript
interface Song {
  id: string;
  title: string;
  artist: string;
  genre: string[];
  key?: string;
  tempo?: number;
  status: 'ready' | 'practice' | 'retired';
  karaokeNumber?: {
    dam?: string;
    joysound?: string;
  };
  lastPerformed?: Date;
  performanceCount: number;
  notes?: string;
  tags: string[];
}
```

**楽曲データベース機能仕様**
- 全文検索（曲名・アーティスト・タグ）
- ジャンル複数選択フィルタ
- アーティスト名・曲名・マッチスコアで昇順/降順/off(DB登録順)ソート
- 人気順・最近歌った順ソート
- 楽曲データの中に「リクエストは受け付けないフラグ」(セットリストの中には入れる可能性がある)を指定可能
  - ユーザーには見せず、Vtuberだけが使える

**リクエスト・質問管理機能仕様**
- NGワードフィルタリング
- 質問の自動カテゴライズ
- 配信用表示モード
  - OBS Browser Source対応
  - カスタマイズ可能なデザインテーマ
  - アニメーション効果
- 回答の動画IDとタイムスタンプ管理（暫定、実装しないかも）

**セットリスト作成機能**
- 楽曲データベースから検索・ドラッグアンドドロップなどで追加・整理

#### 3.2.4 公開ページ機能

**画面仕様**
- 1ページ・タブで「配信予定」と「楽曲検索」、「質問投稿」、「リンク集」を切り替え可能
  - タブは上にするか左にするか、要検討
    - 多分左にした方がよい？
    - モバイルではハンバーガーメニューで左に出す

**機能仕様**
- 配信予定は1週間を基本ビューとし、1か月表示もできるようにする
  - 枠種別によるハイライト・デミニッシュ機能
  - 枠が立っている場合はそこへのリンク
- 楽曲検索
  - 編集距離1のあいまい検索、全フィールド対象
  - ジャンルによるフィルタリング
  - 楽曲にリクエスト投稿ボタン、押したら投稿画面ポップアップ
    - オプションでコメント、リクエスト先（歌枠全般or特定歌枠or歌みた）
      - 配信中の時間帯はデフォルトが特定歌枠になる
- 質問投稿
    - 質問と、リクエスト先（質問全般or特定枠）を記入
- ユーザー別にリクエスト・質問レート制限あり
- リンク
  - プロフィールに設定してあるリンクを一覧表示
- カラーテーマ変更（ダーク・ライトとシステムデフォルトによる選択）

**実装仕様**
- 完全静的生成（ビルド時）
- OGP自動生成
- 検索はstaticseekを利用
- リクエスト・質問はDBに格納
- レート制限するユーザーの区別はクッキーで行う

**パフォーマンス目標**
- Lighthouse Score: 95以上
- First Contentful Paint: 1.0秒以内
- Time to Interactive: 2.0秒以内

#### 3.2.5 アナリティクス機能

要検討。何ができるか、何をすべきかが検討しきれていない。そのため最初は実装しない。

### 3.3 非機能要件

#### セキュリティ
- Content Security Policy設定（selfのみ。スクリプト/CSSは全て別ファイルにし、インラインは許さない）
- Rate Limiting（API: 100req/min）
- SQLインジェクション対策（プリペアドステートメント、サニタイズ）
- XSS対策（React自動エスケープ + DOMPurifyなど）
- すべての入力文字には適切な文字数上限を設定する
  - 文字列長バリデーション（フロントエンド/バックエンド）

#### パフォーマンス
- API応答時間: p95で200ms以内
- 同時接続数: 1000ユーザー対応
- データベースクエリ: インデックス最適化

#### 可用性
- Cloudflare Global Networkによる99.9%稼働

## 4. ユーザー体験設計

### 4.1 ペルソナ

#### Primary: 個人VTuber「みゆき」
- 活動歴: 1年
- 技術レベル: 初級（Spreadsheet使える程度）
- 課題: 配信準備に時間がかかる、楽曲管理が煩雑
- 目標: もっと配信内容に集中したい

#### Secondary: リスナー「たける」
- 視聴歴: 2年
- デバイス: スマートフォン中心
- 課題: 推しの配信予定を見逃す、リクエストしたい曲がわからない
- 目標: 推しの配信を全て追いたい

### 4.2 ユーザージャーニー

```
[初回セットアップ]
1. ランディングページ訪問
   └→ 「無料で始める」クリック
2. メールアドレス入力
   └→ Magic Link受信
3. 認証完了
   └→ オンボーディング開始
4. 基本情報入力
   └→ ダッシュボード表示

[日常利用]
1. ダッシュボードアクセス
2. 今週の配信予定確認
3. 配信準備チェックリスト確認
4. リクエスト・質問確認・整理
5. 配信実施
6. アナリティクス確認
```

### 4.3 UI/UXガイドライン

#### デザイン原則
1. **Simple**: 機能を詰め込みすぎない
2. **Intuitive**: 説明なしで使える
3. **Responsive**: どのデバイスでも快適
4. **Accessible**: WCAG 2.1 AA準拠(努力目標)
5. **Delightful**: 使っていて楽しい

## 5. 運用・保守

### 5.1 監視項目

| 項目 | 閾値 | アラート条件 |
|-----|------|------------|
| API応答時間 | 500ms | p95 > 500ms |
| エラー率 | 1% | 5分間で1%超過 |
| Workers使用量 | 90,000/日 | 90%到達 |
| D1容量 | 8GB | 80%到達 |

### 5.2 バックアップ戦略
- D1: 自動バックアップ ( https://developers.cloudflare.com/d1/reference/time-travel/ )

### 5.3 アップデート戦略
- APIが変わるようなアップデートは停止時間をとりメンテナンスとする
  - Blue-Green Deploymentはしない予定
  - DBのマイグレーションもメンテナンス時間で行う
- 微修正はサイレント修正するかも(UIの色変えたりとかそういうレベル)
- 公開ページのupdateは停止時間をとり全アカウント再生成・デプロイ
- 本番前に試験をできるようにしたい
  - テストサーバーでやる？検証はどうやる？

## 6. 成功指標

暫定指標。指標の妥当性含め要検討。
Discordコミュニティを作るかは不明。最初は作らない。
ユーザーアンケートの手法も未定。最初はアンケートはとらず、GitHub Issueで要求のみ管理する。

### 6.1 定量的指標

| KPI | 目標値 | 測定方法 |
|-----|--------|---------|
| MAU（月間アクティブユーザー） | 100名 | Google Analytics |
| 平均セッション時間 | 5分以上 | Google Analytics |
| 配信準備時間削減率 | 50% | ユーザーアンケート |
| システム稼働率 | 99.9% | Cloudflare Analytics |

### 6.2 定性的指標
- ユーザー満足度（NPS: 40以上）
- 機能リクエストの実装率（月n機能）
- コミュニティの活性度（Discord参加者数）

## 7. リスクと対策

### 7.1 技術的リスク

| リスク | 影響度 | 発生確率 | 対策 |
|-------|--------|----------|------|
| Cloudflare障害 | 高 | 低 | マルチリージョン対応 |
| APIレート制限 | 中 | 中 | キャッシュ戦略強化 |
| データ損失 | 高 | 低 | 自動バックアップ |

### 7.2 事業リスク

| リスク | 影響度 | 発生確率 | 対策 |
|-------|--------|----------|------|
| 競合サービス登場 | 中 | 高 | 差別化機能の継続開発 |
| ユーザー獲得困難 | 高 | 高 | ？ |
| 無料枠超過 | 中 | 低 | 有料プラン検討 |

## 8. 将来展望

### 8.1 短期
- Discord Bot連携
- 配信アーカイブ管理

### 8.2 中期
- モバイルアプリ（React Native）
- AI機能（文章からのスケジュール抽出や自動スケジューリングなど）

### 8.3 長期
- グローバル展開（多言語対応）
- コラボレーション機能
- 収益分析ダッシュボード

## 9. まとめ

VTuneHubは、VTuber活動の「めんどくさい」を解決し、クリエイティブな活動に集中できる環境を提供します。Cloudflareのモダンなインフラを最大限活用し、完全無料で高品質なサービスを実現。シンプルなMVPから始め、ユーザーフィードバックを基に着実に成長させていく、持続可能なプロダクトを目指します。

